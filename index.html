<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT_ALL</title>
    <link rel="stylesheet" href="/static/chat-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <div class="chat-container">
      <h1>GPT_ALL</h1>
      <div class="chat-window" id="chat-window"></div>
      <form id="input-form">
        <textarea
          id="user-input"
          name="user-input"
          placeholder="Enter your message..."
          rows="1"
        ></textarea>
        <div class="tabBar">
          <button id="clear-chat-btn" type="button">Clear</button>
          <input type="submit" value="Send" />
        </div>
      </form>
    </div>
    <script>
        const chat = document.getElementById("chat-window");
        const inputForm = document.getElementById("input-form");
        const userInput = document.getElementById("user-input");
        const clearChatBtn = document.getElementById("clear-chat-btn");

        let memory = [];

        inputForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const userText = userInput.value.trim();
            if (!userText) return;

            chat.innerHTML += `<div class="message-wrapper user"><div class="user-message">${userText}</div><img class="useravatar" src="${userAvatarUrl}" /></div>`;
            userInput.value = "";

            const response = await fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ user_input: userText, memory }),
            });

            if (response.ok) {
                const data = await response.json();
                chat.innerHTML += `<div class="message-wrapper ai"><img class="aiavatar" src="${aiAvatarUrl}" /><div class="ai-message">${data.response}</div></div>`;
                memory = data.memory;
                chat.scrollTop = chat.scrollHeight;
            } else {
                chat.innerHTML += `<div class="message-wrapper ai"><div class="ai-message">Error: Unable to get a response from the assistant.</div></div>`;
            }
        });

        clearChatBtn.addEventListener("click", () => {
            chat.innerHTML = "";
        });
    </script>
    <script>
        const userAvatarUrl = "/static/U1.webp";
        const aiAvatarUrl = "/static/J5.webp";
    </script>
</body>
</html>